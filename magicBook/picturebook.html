<!DOCTYPE html>
<html style="width: 100%; height: 100%;" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../CSS/icon.css">
    <link rel="stylesheet" href="../CSS/interface.css">
    <link rel="stylesheet" href="../CSS/every_four_button.css">
    <link rel="stylesheet" href="./css/picturebook.css">
    <script src="./js/crawler.js"></script>
    <title>繪本</title>

    <script>
        const puppeteer = require('puppeteer');

        function Nooo(web) {
            (async () => {
                let browser = await puppeteer.launch({
                    executablePath: 'C:/Program Files (x86)/Google/Chrome/Application/chrome.exe',
                    // args: ['--start-fullscreen'],
                    headless: false
                });
                const page = await browser.newPage();
                await page.goto(web);

                page.on('colse', async () => {
                    await browser.close();
                });

                await page.exposeFunction('colseBrowser', () => {
                    page.emit('colse');
                });

                await page.evaluate(() => {
                    
                    document.querySelector('.fp-fullscreen').click();
                    setTimeout(() => {
                        document.querySelector('.fp-ui').click()
                    }, 2000);
                    document.querySelector('.fp-fullscreen').onclick = () => window.colseBrowser();
                });

            })();
        }
    </script>
</head>
<!-- onload="ShowTime()" -->
<!-- onload="OpenDataList()" -->

<body style="width: 100%; height: 100%;" onload="OpenDataList()">
    <div class="home_page">
        <a class="home_title">繪本</a>

        <div id="today"></div>
        <br>
        <div id="showtime"></div>

    </div>

    <div class="tags">
        <div id="parent_tag" class="tag" onclick="window.location.hash = '#parent_recommend'">
            <img src="./image/icon_parent.png">
            <span>家長推薦</span>
        </div>

        <div id="machine_tag" class="tag" onclick="window.location.hash = '#machine_recommend'">
            <img src="./image/icon_tablet.png ">
            <span>學習機推薦</span>
        </div>

        <div id="else_tag" class="tag" onclick="window.location.hash = '#else_book'">
            <img src="./image/icon_book.png">
            <span>全部繪本</span>
        </div>
    </div>

    <div class="maincontent">
        <div id="parent_recommend">
            <div class="book">
                <div class="bookname-div">
                    <h2>環遊世界做蘋果派</h2>
                    <img class="voice" src=" ../icons/speaker.png" />

                </div>
                <div class="activity-div">
                    <img src="https://children.moc.gov.tw/resource/animate_image/6850.jpg">
                    <button onclick='Nooo("https:\/\/children.moc.gov.tw/book/215552")'>
                        <img src="./image/icon_watchVideo.png" />
                        <h2>觀看繪本</h2>
                    </button>
                </div>
            </div>

            <div class="book">
                <div class="bookname-div">
                    <h2>蘋果甜蜜蜜</h2>
                    <img class="voice" src=" ../icons/speaker.png" />

                </div>
                <div class="activity-div">
                    <img src="https://children.moc.gov.tw/resource/animate_image/6892.jpg">
                    <button onclick='Nooo("https:\/\/children.moc.gov.tw/book/218424")'>
                        <img src="./image/icon_watchVideo.png" />
                        <h2>觀看繪本</h2>
                    </button>
                </div>
            </div>


        </div>

        <div id="machine_recommend">

            <div class="book">
                <div class="bookname-div">
                    <h2>我的水果寶寶</h2>
                    <img class="voice" src=" ../icons/speaker.png" />

                </div>
                <div class="activity-div">
                    <img src="https://children.moc.gov.tw/resource/animate_image/7008.png">
                    <button onclick='Nooo("https:\/\/children.moc.gov.tw/book/218424")'>
                        <img src="./image/icon_watchVideo.png" />
                        <h2>觀看繪本</h2>
                    </button>
                </div>
            </div>

            <div class="book">
                <div class="bookname-div">
                    <h2>香蕉的祕密</h2>
                    <img class="voice" src=" ../icons/speaker.png" />

                </div>
                <div class="activity-div">
                    <img src="https://children.moc.gov.tw/resource/animate_image/6924.jpg">
                    <button onclick='Nooo("https:\/\/children.moc.gov.tw/book/219116")'>
                        <img src="./image/icon_watchVideo.png" />
                        <h2>觀看繪本</h2>
                    </button>
                </div>
            </div>
        </div>

        <div id="else_book">

        </div>

    </div>
    <div>
        <a href="../game_home.html" class="sosfloat sos_mark" id="menu-share">
            <i class="fab fa-share my-float"><img src="../photo/help.png" width="70%"></i>
        </a>
    </div>

    <div class="return_mark">
        <a href="./magicBook.html" class="returnfloat" id="menu-share">
            <i class="fab fa-share return-float"><img src="../photo/return.png"></i>
        </a>
    </div>

    <div class="home_mark">
        <a href="../game_home.html" class="homefloat" id="menu-share">
            <i class="fab fa-share my-float"><img src="../photo/gobackhome.png" width="70%"></i>
        </a>
    </div>

    <script language="JavaScript">
        function ShowTime() {

            var fullDate = new Date();
            var yyyy = fullDate.getFullYear();
            var MM = (fullDate.getMonth() + 1) >= 10 ? (fullDate.getMonth() + 1) : ("0" + (fullDate.getMonth() + 1));
            var dd = fullDate.getDate() < 10 ? ("0" + fullDate.getDate()) : fullDate.getDate();
            document.getElementById('today').innerHTML = yyyy + "/" + MM + "/" + dd;

            var NowDate = new Date();
            var h = NowDate.getHours();
            var m = NowDate.getMinutes();
            document.getElementById('showtime').innerHTML = h + ':' + m;
            setTimeout('ShowTime()', 1000);
        }

        function toggleBtn() {
            const Btns = document.querySelector(".btns");
            const add = document.getElementById("add");
            const remove = document.getElementById("remove");
            const btn = document.querySelector(".btns").querySelectorAll("a");
            Btns.classList.toggle("open");
            if (Btns.classList.contains("open")) {
                remove.style.display = "block";
                add.style.display = "none";
                btn.forEach((e, i) => {
                    setTimeout(() => {
                        bottom = 65 * i;
                        e.style.bottom = bottom + "px";
                        console.log(e);
                    }, 100 * i);
                });
            } else {
                add.style.display = "block";
                remove.style.display = "none";
                btn.forEach((e, i) => {
                    e.style.bottom = "0px";
                });
            }
        }
    </script>

    <script>
        function OpenDataList() {
            const dataurl = "https://children.moc.gov.tw/opendata/2";
            const request = new XMLHttpRequest();
            request.open('GET', dataurl);
            request.responseType = 'json';
            request.send();
            // let jsontext;
            request.onreadystatechange = function (evt) {
                if (request.readyState !== 4) {
                    return;
                }
                // console.log("waited for it to finish")
                console.log(request.response);
                recommendListbook(request.response);
            }
        }

        function recommendListbook(jsons) {
            let request = new XMLHttpRequest();
            let imgurltemp = 6805;

            for (let i = 1; i < jsons.length; i++) {
                let imgurl = 'https://children.moc.gov.tw/resource/animate_image/' + imgurltemp + '.jpg';

                let bookdiv = document.createElement("div");
                bookdiv.className = 'book';

                let bookname = document.createElement("div");
                bookname.className = 'bookname-div'

                let name = document.createElement("h2");
                name.append(document.createTextNode(jsons[i]['name']));

                let voice_ic = document.createElement('img');
                voice_ic.src = "../icons/speaker.png";
                voice_ic.className = "voice"

                bookname.append(name);
                bookname.append(voice_ic);

                bookdiv.append(bookname);

                imgurltemp = getimg(imgurltemp, bookdiv, jsons[i]['url']);
                imgurltemp++;
            }

        }

        function getimg(imgurltemp, bookdiv, url) {
            const list = document.querySelector("#else_book");
            let request = new XMLHttpRequest();
            let imgurl = 'https://children.moc.gov.tw/resource/animate_image/' + imgurltemp + '.jpg';
            request.open('GET', imgurl);
            request.send()
            request.onreadystatechange = function (evt) {
                if (request.readyState !== 4)
                    return;
                if (request.status != 404) {
                    let activity_div = document.createElement("div");
                    activity_div.className = 'activity-div';

                    let bookimg = document.createElement('img');
                    bookimg.src = imgurl
                    activity_div.append(bookimg);

                    let watch_btn = document.createElement('button');
                    watch_btn.onclick = function () {
                        showWeb(url);
                    }
                    let watch_ic = document.createElement('img');
                    watch_ic.src = "./image/icon_watchVideo.png";
                    let watch_h2 = document.createElement('h2');
                    watch_h2.append("觀看繪本");
                    watch_btn.append(watch_ic, watch_h2);

                    activity_div.append(watch_btn);
                    bookdiv.append(activity_div);
                    list.append(bookdiv);

                } else {
                    // console.log(imgurltemp);
                    let activity_div = document.createElement("div");
                    activity_div.className = 'image-div';
                    let bookimg = document.createElement('img');
                    bookimg.src = 'https://children.moc.gov.tw/resource/animate_image/6805.jpg';
                    activity_div.append(bookimg);
                    bookdiv.append(activity_div);
                    list.append(bookdiv);
                }
                return imgurltemp;
            }
            return imgurltemp;
        }
    </script>
    <script>
    </script>

</body>

</html>