<!DOCTYPE html>
<html style="width: 100%; height: 100%;" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../CSS/icon.css">
    <link rel="stylesheet" href="../CSS/interface.css">
    <link rel="stylesheet" href="../CSS/every_four_button.css">
    <link rel="stylesheet" href="./css/picturebook.css">
    <title>Document</title>

    <script>
        const puppeteers = require('puppeteer');
        // var videos = document.createElement('video');
        function web(web) {
            (async () => {
                const browser = await puppeteers.launch({
                    // executablePath: 'C:/Program Files (x86)/Google/Chrome/Application/chrome.exe',
                    headless: false
                });
                const page = await browser.newPage();
                await page.goto(web);
                // videos = await page.$$eval('video', video => video);
                // page.waitFor(10000);
                // const btn = await page.waitForSelector('fp-fullscreen');
                // await btn.click(); // doesn't work
                // await page.$eval('.fp-ui', elem => elem.click());
                await page.click('.fp-fullscreen');
                await page.click('.fp-ui', {
                    delay: 2000
                });

                // await page.$eval('.fp-ui', elem => elem.click());

                // console.log(videos);
                // await browser.close();
            })();
        }
    </script>
</head>
<!-- onload="ShowTime()" -->

<body onload="OpenDataList()" style="width: 100%; height: 100%;" background="../image/background/desk.png">
    <div class="home_page">
        <a href="../game_home.html">繪本</a>

        <div id="today"></div>
        <br>
        <div id="showtime"></div>

    </div>

    <!-- <div id="show_page"> -->
    <div id="learn_bookdropdown">學習相關推薦</div>
    <div class="booklist" id="learn_book" style="background-color: cadetblue; display: block;">
        <!-- <button style="position: absolute;" onclick="OpenDataList()">try try see</button> -->
        <div class="book" onclick='web("https:\/\/children.moc.gov.tw/book/215552")'>
            <div class="text-div">
                <h2>環遊世界做蘋果派</h2>
            </div>
            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/215552.jpg">
            </div>

        </div>

        <div class="book" onclick='web("https:\/\/children.moc.gov.tw/book/216245")'>
            <div class="text-div">
                <h2>送你一顆蘋果</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/216245.jpg">

            </div>
        </div>


        <div class="book" onclick='web("https:\/\/children.moc.gov.tw/book/217133")'>
            <div class="text-div">
                <h2>致命的蘋果</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/217133.jpg">
            </div>

        </div>


        <div class="book" onclick='web("https:\/\/children.moc.gov.tw/book/217317")'>
            <div class="text-div">
                <h2>蘋果的引力-牛頓</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/217317.jpg">
            </div>
        </div>


        <div class="book" onclick='web("https:\/\/children.moc.gov.tw/book/217849")'>
            <div class="text-div">
                <h2>蘋果纖維</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/217849.jpg">
            </div>
        </div>

        <div class="book" onclick='web("https:\/\/children.moc.gov.tw/book/218424")'>
            <div class="text-div">
                <h2>蘋果甜蜜蜜</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/218424.jpg">
            </div>

        </div>
    </div>
    <div id="recommend_bookdropdown">家長推薦</div>
    <div class="booklist" id="recommend_book" style="background-color: cadetblue; display: block;">
        <!-- <button style="position: absolute;" onclick="OpenDataList()">try try see</button> -->
        <div class="book">
            <div class="text-div">
                <h2>環遊世界做蘋果派</h2>
            </div>
            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/215552.jpg">
            </div>

        </div>

        <div class="book">
            <div class="text-div">
                <h2>送你一顆蘋果</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/216245.jpg">

            </div>
        </div>


        <div class="book">
            <div class="text-div">
                <h2>致命的蘋果</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/217133.jpg">
            </div>

        </div>


        <div class="book">
            <div class="text-div">
                <h2>蘋果的引力-牛頓</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/217317.jpg">
            </div>
        </div>


        <div class="book">
            <div class="text-div">
                <h2>蘋果纖維</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/217849.jpg">
            </div>
        </div>

        <div class="book">
            <div class="text-div">
                <h2>蘋果甜蜜蜜</h2>
            </div>

            <div class="image-div">
                <img src="https://children.moc.gov.tw/resource/book_image/218424.jpg">
            </div>

        </div>
    </div>
    <div id="disrecommend_bookdropdown">總書目</div>
    <div class="booklist" id="disrecommend_book" style="background-color:cyan; display: block; margin-top:0px">

    </div>
    <!-- </div> -->


    <div>
        <a href="../game_home.html" class="sosfloat sos_mark" id="menu-share">
            <i class="fab fa-share my-float"><img src="../photo/help.png" width="70%"></i>
        </a>
    </div>

    <!-- <div class="fabs setting_mark" onclick="toggleBtn()">
      <div class="action">
        <i class="fas" id="add"><img src="../photo/settings.png" width="110%"></i>
        <i class="fas" id="remove" style="display: none"><img src="../photo/settings.png" width="110%"></i>
      </div>

      <div class="btns">
        <a href="../personalprofile.html" class="btn"><i class="fab "><img src="../photo/user.png" title="個人簡介"
          width="95%"></i></a>
        <a href="../history.html" class="btn"><i class="fab "><img src="../photo/record.png" title="歷史紀錄"
          width="95%"></i></a>
        <a href="../score.html" class="btn"><i class="fab "><img src="../photo/analysis.png" title="學習歷程"
          width="95%"></i></a>
      </div>

    </div> -->

    <div class="return_mark">
        <a href="./magicBook.html" class="returnfloat" id="menu-share">
            <i class="fab fa-share return-float"><img src="../photo/return.png"></i>
        </a>
    </div>

    <div class="home_mark">
        <a href="../game_home.html" class="homefloat" id="menu-share">
            <i class="fab fa-share my-float"><img src="../photo/gobackhome.png" width="70%"></i>
        </a>
    </div>

    <script language="JavaScript">
        function ShowTime() {

            var fullDate = new Date();
            var yyyy = fullDate.getFullYear();
            var MM = (fullDate.getMonth() + 1) >= 10 ? (fullDate.getMonth() + 1) : ("0" + (fullDate.getMonth() + 1));
            var dd = fullDate.getDate() < 10 ? ("0" + fullDate.getDate()) : fullDate.getDate();
            document.getElementById('today').innerHTML = yyyy + "/" + MM + "/" + dd;

            var NowDate = new Date();
            var h = NowDate.getHours();
            var m = NowDate.getMinutes();
            document.getElementById('showtime').innerHTML = h + ':' + m;
            setTimeout('ShowTime()', 1000);
        }

        function toggleBtn() {
            const Btns = document.querySelector(".btns");
            const add = document.getElementById("add");
            const remove = document.getElementById("remove");
            const btn = document.querySelector(".btns").querySelectorAll("a");
            Btns.classList.toggle("open");
            if (Btns.classList.contains("open")) {
                remove.style.display = "block";
                add.style.display = "none";
                btn.forEach((e, i) => {
                    setTimeout(() => {
                        bottom = 65 * i;
                        e.style.bottom = bottom + "px";
                        console.log(e);
                    }, 100 * i);
                });
            } else {
                add.style.display = "block";
                remove.style.display = "none";
                btn.forEach((e, i) => {
                    e.style.bottom = "0px";
                });
            }
        }
    </script>

    <script>
        document.getElementById("recommend_bookdropdown").addEventListener("click", () => {
            var click = document.querySelector("#recommend_book")
            if (click.style.display === "block")
                click.style.display = "none"
            else {
                click.style.display = "block"
            }
        })

        document.getElementById("disrecommend_bookdropdown").addEventListener("click", () => {
            var click = document.querySelector("#disrecommend_book")
            if (click.style.display === "block")
                click.style.display = "none"
            else {
                click.style.display = "block"
            }
        })

        document.getElementById("learn_bookdropdown").addEventListener("click", () => {
            var click = document.querySelector("#learn_book")
            if (click.style.display === "block")
                click.style.display = "none"
            else {
                click.style.display = "block"
            }
        })
    </script>

    <script>
        let puppeteer = require('puppeteer');

        function OpenDataList() {
            const dataurl = "https://children.moc.gov.tw/opendata/2";
            const request = new XMLHttpRequest();
            request.open('GET', dataurl);
            request.responseType = 'json';
            request.send();
            // let jsontext;
            request.onreadystatechange = function (evt) {
                if (request.readyState !== 4) {
                    return;
                }
                // console.log("waited for it to finish")
                console.log(request.response);
                recommendListbook(request.response);
            }
        }

        function recommendListbook(jsons) {
            let request = new XMLHttpRequest();
            const list = document.querySelector("#disrecommend_book");
            let imgurltemp = 6805;

            for (let i = 1; i < jsons.length; i++) {
                let imgurl = 'https://children.moc.gov.tw/resource/animate_image/' + imgurltemp + '.jpg';

                let bookDropdown = document.createElement("div");


                let bookdiv = document.createElement("div");
                bookdiv.className = 'book';
                bookdiv.onclick = function () {
                    (async () => {
                        const browser = await puppeteer.launch({
                            executablePath: 'C:/Program Files (x86)/Google/Chrome/Application/chrome.exe',
                            headless: false
                        });
                        const page = await browser.newPage();
                        await page.goto(jsons[i]['url']);
                        await page.click('.fp-fullscreen');
                        await page.click('.fp-ui', {
                            delay: 2000
                        });
                    })();

                }

                // console.log(bookdiv.onclick);
                let book_textdiv = document.createElement("div");
                book_textdiv.className = 'text-div'

                let bookname = document.createElement("h2");
                bookname.append(document.createTextNode(jsons[i]['name']));

                book_textdiv.append(bookname);

                bookdiv.append(book_textdiv);
                imgurltemp = getimg(imgurltemp, bookdiv, i);
                console.log(imgurltemp);

                imgurltemp++;
            }

            // let imgurl = 'https://children.moc.gov.tw/resource/animate_image/' + imgurltemp + '.jpg';

            // let bookdiv = document.createElement("div");
            // bookdiv.className = 'book';

            // let book_textdiv = document.createElement("div");
            // book_textdiv.className = 'text-div'

            // let bookname = document.createElement("h2");
            // bookname.append(document.createTextNode(jsons[0]['name']));

            // book_textdiv.append(bookname);

            // bookdiv.append(book_textdiv);

            // getimg(imgurltemp, bookdiv,1);

            // imgurltemp++;


        }

        function getimg(imgurltemp, bookdiv, i) {
            console.log(i);

            const list = document.querySelector("#disrecommend_book");
            let request = new XMLHttpRequest();
            let imgurl = 'https://children.moc.gov.tw/resource/animate_image/' + imgurltemp + '.jpg';
            request.open('GET', imgurl);
            request.send()
            request.onreadystatechange = function (evt) {
                if (request.readyState !== 4)
                    return;
                // console.log("waited for it to finish")
                if (request.status != 404) {
                    let bookdiv_imgdiv = document.createElement("div");
                    bookdiv_imgdiv.className = 'image-div';
                    let bookimg = document.createElement('img');
                    bookimg.src = imgurl
                    bookdiv_imgdiv.append(bookimg);
                    bookdiv.append(bookdiv_imgdiv);
                    list.append(bookdiv);
                    console.log("success");

                } else {
                    console.log(imgurltemp);
                    let bookdiv_imgdiv = document.createElement("div");
                    bookdiv_imgdiv.className = 'image-div';
                    let bookimg = document.createElement('img');
                    bookimg.src = 'https://children.moc.gov.tw/resource/animate_image/6805.jpg';
                    bookdiv_imgdiv.append(bookimg);
                    bookdiv.append(bookdiv_imgdiv);
                    list.append(bookdiv);
                    console.log("success");
                    // getimg(++imgurltemp, bookdiv, i);
                }
                return imgurltemp;
            }
            return imgurltemp;
        }
    </script>


</body>

</html>